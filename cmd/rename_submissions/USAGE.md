# 使用示例

这个文档展示了如何使用提交文件夹重命名脚本的详细步骤。

## 预览模式运行结果

运行预览模式后，您会看到类似以下的输出：

```
开始重命名提交文件夹...
Matter 路径: ../../matter
🔍 DRY RUN 模式：仅预览，不执行实际操作
找到 9 个提交

处理第 1/9 个提交:
  原文件夹: matter\77\root\222-777-777
  新文件夹名: 777-222-777
  作者: 777, 赛道: 222, 作品: 777
  🔍 DRY RUN: 跳过实际操作

处理第 2/9 个提交:
  原文件夹: matter\999\root\111-999-999
  新文件夹名: 999-111-999
  作者: 999, 赛道: 111, 作品: 999
  🔍 DRY RUN: 跳过实际操作

...

处理完成！成功: 9, 失败: 0
```

## 实际执行步骤

### 1. 确认预览结果
仔细检查预览输出，确保：
- 所有文件夹路径正确
- 作者、赛道、作品名信息准确
- 新文件夹名符合预期格式

### 2. 备份数据（重要！）
在执行实际重命名前，请务必备份：
```bash
# 备份数据库
mysqldump -h 127.0.0.1 -u root -p tank > tank_backup_$(date +%Y%m%d_%H%M%S).sql

# 备份文件夹
cp -R matter matter_backup_$(date +%Y%m%d_%H%M%S)
```

### 3. 修改配置执行实际操作
编辑 `config.json`，将 `dryRun` 设置为 `false`：
```json
{
  "mysql": {
    "host": "127.0.0.1",
    "port": 3306,
    "username": "root",
    "password": "your_password",
    "database": "tank",
    "charset": "utf8"
  },
  "matterPath": "../../matter",
  "dryRun": false,
  "maxNameLength": 50
}
```

### 4. 执行重命名
```bash
# Windows
run.bat

# Linux/Mac
chmod +x run.sh
./run.sh
```

### 5. 验证结果
执行完成后，检查：
- 文件夹是否正确重命名
- 数据库中的路径是否更新
- 应用程序是否正常工作

## 预期的文件夹变化

### 重命名前
```
matter/
├─77/
│  └─root/
│      └─222-777-777/
├─888/
│  └─root/
│      └─222-888-888/
└─999/
    └─root/
        └─111-999-999/
```

### 重命名后
```
matter/
├─77/
│  └─root/
│      └─777-222-777/
├─888/
│  └─root/
│      └─888-222-888/
└─999/
    └─root/
        └─999-111-999/
```

## 数据库变化

脚本会更新 `tank41_matter` 表中的以下字段：
- `name`: 文件夹名称
- `path`: 文件路径（所有子文件和子文件夹的路径也会相应更新）

## 可能的错误和解决方案

### 1. 文件夹已存在
```
❌ 重命名失败: 目标文件夹已存在: matter/77/root/张三-AI赛道-智能系统
```
**解决方案**: 手动处理重复的文件夹或调整命名规则。

### 2. 权限错误
```
❌ 重命名失败: 权限不足
```
**解决方案**: 确保运行脚本的用户有足够的文件系统权限。

### 3. 数据库更新失败
```
❌ 更新数据库失败: Error 1054: Unknown column 'name' in 'field list'
```
**解决方案**: 检查数据库表结构和权限。

## 回滚操作

如果需要回滚，可以：
1. 从备份恢复文件夹
2. 从备份恢复数据库
3. 或者创建反向脚本恢复原始命名

## 注意事项

1. **执行前必须备份**：这是不可逆操作
2. **测试环境验证**：建议先在测试环境中验证
3. **业务停机**：建议在业务低峰期执行
4. **权限检查**：确保有足够的文件系统和数据库权限